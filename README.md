# CTFramework文档

当前文档对应的框架版本：v0.2

* 文档和实际内容可能会有所出入，一切以实际代码为准！
* 不足之处，请多包涵！如果有任何建议，可以发送到我的邮箱：1322080797@qq.com，让我们一起进步！

# 框架介绍

开发环境：Unity2019.3.x LTS、Visual Studio 2019

特点：简单轻量，高可读，高可用，高可拓展

设计思想：数据，行为，初始化三者分离，面向接口编程

* 数据：由配置文件驱动（目前均直接使用Unity自带的ScriptableObject）
* 行为：由加载器驱动（目前均使用Loader命名加载器）
* 初始化：由工厂类驱动

## 前言

CTFramework将是我**自主编写**的**第一个完整**的**Unity程序框架**。一来是对之前学过的知识起到总结与回顾的作用，二来是能够为今后的开发减少一些负担。种种原因，之前v0.1很遗憾没能在暑假完成，甚是遗憾。如今，我顺利上岸，将有有足够的时间重新开始框架的编写。吸取之前的失败经验，这次会把每个模块的代码，文档，案例等写清楚，写完整，再开发其他模块，循序渐进。这次框架必须**保证简洁干净**，不要有任何冗余的案例或资源。同时兼顾**高可读**、**高可用**和**高可扩展性**，减少代码重构的成本。

​       总体设计思路：分模块开发，顺利完成一个模块的**所有开发工作**，再进入下一模块。每一模块分以下几个阶段：

> * 早期规划：如果某模块功能复杂，则利用“亿图图示”或“Typora”进行早期规划，如需求分析，草图设计；否则，大脑构建全流程，直接进入开发阶段
> * 中期开发：
>   * 先定义接口，确定功能需求
>   * 编写加载器类，实现接口。这部分通常会和配置文件同时进行
>   * 编写管理类，这部分一般很固定，调用加载器方法去实现接口即可
>   * 编写工厂类，生产管理类和配置文件等，整合进框架
> * 后期完善：设计测试案例，完善文档和思维导图，重构不良代码等
>
> 反复如此，直到设计完所有模块

预计开发内容如下

* 核心管理模块：资源管理、UI管理、音乐管理、网络管理、动画管理、AI管理
* 辅助管理模块：玩家数据管理、事件管理、场景管理、定时回调管理

好了，废话不多说，让我~~们~~开始CTFramework的编写吧！

​																																									  	聪头

​																																								2021年11月10日

# v0.1 内容

时间：2021年11月10日16:03:07

编写各模块功能，详见文档

# v0.2 更新内容

时间：2022年4月18日18:29:01

v0.2版本较v0.1没有多大变化，甚至删减了网络模块（对旧网络框架不太满意）

主要修改了多处小bug，改动幅度较大的部分记载如下：

> 文档

本文档定位是教程文档，将移除之前绝大部分教程无关内容

> 系统模块

* 新增**框架辅助模块**
  * 将一部分管理类交付给单例类 `CTHelper.cs`管理

* 完善全局配置文件的工作机制
  * 提供重定向方案
  * 提供对整个框架的全局配置

* 优化工厂
  * 所有模块按需加载，不会创建不需要的模块内容以节省内存
  * 统一核心模块内部的生产方式

* 完善玩家数据类，由`CTHelper`管理
  * 分为**运行时数据（Key以~开头）**和**存档数据**


> UI模块

* 每次Push时可传参
* 提供预加载选项
  * 需预先使用PushToCachePool将面板推入缓存池（注意缓存池的大小）

* 重新设计IController
  * 彻底避免拆装箱
  * 基于链式编程思想

* 缓存的UI面板可以手动卸载

>音乐模块

* 音乐音效新增重载路径，方便资产复用
* ~~背景音乐的淡入淡出~~（拒接接入，需要引入DOTween插件）
  * 改进，暴露获取系统音量和配置文件音量的方式，由用户自己去相乘控制音量

* 音效预加载可以不进行缓存，在播放一次后自动删除缓存（应对诸如一次性对话的场景）

# 框架使用教程

## 使用的插件

目的：协助优化工作流（部分非必须）

> 所有dll必须直接放在Plugins下，Plugins的位置可以任意调整

* ==Odin==：第三方插件，==必须==。用于编辑器拓展，提供可序列化的ScritableObject
  * 下载路径：Asset Store购买（等我赚够了，我就不用某宝的盗版）
  * 存放路径：`Assets/CTFramework/Dependencies`
* ==AssetBundleBrowser==：官方插件，==非必须==。用于打包AssetBundle包
  * 可以使用脚本替代（详见宣雨松《Unity3d游戏开发》第二版P309）
  * 下载路径：
    * PackageManager：有的话直接装（Unity 2020版本我好像没找到）
    * Github下载：https://github.com/Unity-Technologies/AssetBundles-Browser
  * 存放路径：`Packages`
* ==TextMeshPro==：官方插件，==非必须==。用于文字的显示与特效
  * 下载路径：PackageManager
  * 存放路径：`Assets/CTFramework/Dependencies`
* ==InputSystem==：官方插件，==非必须==。用于输入系统，缺少该插件可能导致案例报错，此时删除案例可以解决
  * 存放路径：`Packages`
* ==Newtonsoft.Json==：第三方插件，==必须==。提供复杂Json的解析
  * 教程URL：https://blog.csdn.net/qq471263589/article/details/95318118
  * 序列化性能比较：https://www.cnblogs.com/landeanfen/p/4627383.html
  * 命名空间：`using Newtonsoft.Json;`
  * Unity提供的JsonUtility只能解析对象，无法直接解析List，数组，Dictionary等类型。因此需要使用Newtonsoft.Json来应对某些场景。能否在项目打包后运行，有待考证
  * 存放路径：`Assets/CTFramework/Plugins`

## 导入框架

新建Unity工程，将Assets内的文件拷贝至工程内即可
